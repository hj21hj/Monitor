<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>êµ­íšŒ ìœ„ì›íšŒ í†µí•© ëª¨ë‹ˆí„°ë§</title>
    <style>
        :root { --primary: #003478; --naver: #03cf5d; --yt: #ff0000; --bg: #f4f7fa; }
        * { box-sizing: border-box; font-family: 'Pretendard', sans-serif; }
        
        body { background: var(--bg); margin: 0; padding: 10px; display: flex; flex-direction: column; gap: 15px; min-height: 100vh; }

        /* [1ë‹¨ê³„] ëª…ë‹¨ ì˜ì—­: ê°„ì†Œí™”ëœ í…Œì´ë¸” */
        .step-1-container { background: white; border-radius: 12px; padding: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); height: 400px; display: flex; flex-direction: column; }
        .control-panel { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 12px; padding: 12px; background: #f1f3f5; border-radius: 8px; align-items: center; }
        .control-panel h2 { font-size: 16px; margin: 0; color: var(--primary); }
        select { flex: 1; min-width: 150px; padding: 10px; border: 1px solid #ced4da; border-radius: 6px; font-size: 14px; font-weight: bold; }
        
        .table-wrapper { overflow: auto; flex: 1; border: 1px solid #dee2e6; border-radius: 8px; }
        table { width: 100%; border-collapse: collapse; font-size: 13px; text-align: center; }
        th { background: #e9ecef; padding: 12px; border-bottom: 2px solid #dee2e6; position: sticky; top: 0; z-index: 10; }
        td { padding: 12px; border-bottom: 1px solid #eee; cursor: pointer; }
        tr:hover { background-color: #f1f8ff; }
        tr.active { background-color: #e8f0fe !important; font-weight: bold; border-left: 5px solid var(--primary); }

        /* ëª¨ë‹¬ íŒì—… ìŠ¤íƒ€ì¼ */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); align-items: center; justify-content: center; padding: 20px; }
        .modal-content { background: white; border-radius: 15px; width: 100%; max-width: 500px; max-height: 90vh; overflow-y: auto; padding: 25px; position: relative; box-shadow: 0 5px 30px rgba(0,0,0,0.3); }
        .modal-header { border-bottom: 2px solid var(--primary); padding-bottom: 10px; margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center; }
        .close-btn { font-size: 28px; cursor: pointer; border: none; background: none; color: #888; line-height: 1; }
        .info-grid { display: grid; grid-template-columns: 80px 1fr; gap: 12px; line-height: 1.6; font-size: 14px; }
        .info-label { font-weight: bold; color: #666; }
        .info-value { color: #333; }

        /* [2ë‹¨ê³„] ë‰´ìŠ¤ ì˜ì—­: ë°˜ì‘í˜• ê·¸ë¦¬ë“œ */
        .step-2-container { display: grid; grid-template-columns: 1fr; gap: 12px; padding-bottom: 20px; }
        .monitor-col { background: #fff; border-radius: 12px; padding: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.06); display: flex; flex-direction: column; max-height: 500px; }
        .col-title { font-weight: bold; font-size: 1.1rem; margin-bottom: 10px; padding-bottom: 8px; border-bottom: 1px solid #eee; }
        .content-scroll { flex: 1; overflow-y: auto; }
        
        .item { padding: 12px 0; border-bottom: 1px solid #f1f1f1; text-decoration: none; color: inherit; display: block; }
        .item-title { font-size: 0.95rem; font-weight: 600; line-height: 1.4; margin-bottom: 4px; }
        .yt-thumb { width: 100%; aspect-ratio: 16/9; background-size: cover; border-radius: 8px; margin-bottom: 8px; background-color: #000; }

        /* ë°ìŠ¤í¬í†± í™˜ê²½ ì„¤ì • */
        @media (min-width: 1024px) {
            body { height: 100vh; overflow: hidden; padding: 15px; }
            .step-1-container { height: 40%; min-height: 300px; }
            .step-2-container { flex: 1; grid-template-columns: 1fr 1fr 1fr; min-height: 0; }
            .monitor-col { max-height: none; }
        }
    </style>
</head>
<body>

<div class="step-1-container">
    <div class="control-panel">
        <h2>ìœ„ì›íšŒ ì„ íƒ</h2>
        <select id="commSelector" onchange="fetchAssemblyList()">
            <optgroup label="ìƒì„ìœ„ì›íšŒ">
                <option value="êµ­íšŒìš´ì˜ìœ„ì›íšŒ">êµ­íšŒìš´ì˜ìœ„ì›íšŒ</option>
                <option value="ë²•ì œì‚¬ë²•ìœ„ì›íšŒ">ë²•ì œì‚¬ë²•ìœ„ì›íšŒ</option>
                <option value="ì •ë¬´ìœ„ì›íšŒ">ì •ë¬´ìœ„ì›íšŒ</option>
                <option value="ê¸°íšì¬ì •ìœ„ì›íšŒ">ê¸°íšì¬ì •ìœ„ì›íšŒ</option>
                <option value="êµìœ¡ìœ„ì›íšŒ">êµìœ¡ìœ„ì›íšŒ</option>
                <option value="ê³¼í•™ê¸°ìˆ ì •ë³´ë°©ì†¡í†µì‹ ìœ„ì›íšŒ">ê³¼í•™ê¸°ìˆ ì •ë³´ë°©ì†¡í†µì‹ ìœ„ì›íšŒ</option>
                <option value="ì™¸êµí†µì¼ìœ„ì›íšŒ">ì™¸êµí†µì¼ìœ„ì›íšŒ</option>
                <option value="êµ­ë°©ìœ„ì›íšŒ">êµ­ë°©ìœ„ì›íšŒ</option>
                <option value="í–‰ì •ì•ˆì „ìœ„ì›íšŒ">í–‰ì •ì•ˆì „ìœ„ì›íšŒ</option>
                <option value="ë¬¸í™”ì²´ìœ¡ê´€ê´‘ìœ„ì›íšŒ" selected>ë¬¸í™”ì²´ìœ¡ê´€ê´‘ìœ„ì›íšŒ</option>
                <option value="ë†ë¦¼ì¶•ì‚°ì‹í’ˆí•´ì–‘ìˆ˜ì‚°ìœ„ì›íšŒ">ë†ë¦¼ì¶•ì‚°ì‹í’ˆí•´ì–‘ìˆ˜ì‚°ìœ„ì›íšŒ</option>
                <option value="ì‚°ì—…í†µìƒìì›ì¤‘ì†Œë²¤ì²˜ê¸°ì—…ìœ„ì›íšŒ">ì‚°ì—…í†µìƒìì›ì¤‘ì†Œë²¤ì²˜ê¸°ì—…ìœ„ì›íšŒ</option>
                <option value="ë³´ê±´ë³µì§€ìœ„ì›íšŒ">ë³´ê±´ë³µì§€ìœ„ì›íšŒ</option>
                <option value="í™˜ê²½ë…¸ë™ìœ„ì›íšŒ">í™˜ê²½ë…¸ë™ìœ„ì›íšŒ</option>
                <option value="êµ­í† êµí†µìœ„ì›íšŒ">êµ­í† êµí†µìœ„ì›íšŒ</option>
                <option value="ì •ë³´ìœ„ì›íšŒ">ì •ë³´ìœ„ì›íšŒ</option>
                <option value="ì—¬ì„±ê°€ì¡±ìœ„ì›íšŒ">ì—¬ì„±ê°€ì¡±ìœ„ì›íšŒ</option>
            </optgroup>
        </select>
        <span id="load-status" style="font-size:12px; color:var(--primary); font-weight:bold;"></span>
    </div>

    <div class="table-wrapper">
        <table>
            <thead>
                <tr>
                    <th>êµ¬ì„±</th>
                    <th>ì„±ëª…</th>
                    <th>ì •ë‹¹</th>
                    <th>ì„ ê±°êµ¬</th>
                </tr>
            </thead>
            <tbody id="memberTbody"></tbody>
        </table>
    </div>
</div>

<div id="infoModal" class="modal" onclick="closeModal()">
    <div class="modal-content" onclick="event.stopPropagation()">
        <div class="modal-header">
            <h3 id="modalName" style="margin:0; color:var(--primary);">ì˜ì› ìƒì„¸ ì •ë³´</h3>
            <button class="close-btn" onclick="closeModal()">&times;</button>
        </div>
        <div id="modalBody" class="info-grid">
            </div>
    </div>
</div>

<div class="step-2-container">
    <div class="monitor-col"><div class="col-title" style="color:var(--naver)">ğŸŸ¢ ë„¤ì´ë²„ ë‰´ìŠ¤</div><div id="naverArea" class="content-scroll"></div></div>
    <div class="monitor-col"><div class="col-title" style="color:var(--primary)">ğŸ”µ êµ¬ê¸€ ë‰´ìŠ¤</div><div id="googleArea" class="content-scroll"></div></div>
    <div class="monitor-col"><div class="col-title" style="color:var(--yt)">ğŸ¬ ìœ íŠœë¸Œ</div><div id="ytArea" class="content-scroll"></div></div>
</div>

<script>
    const ASSEMBLY_KEY = '4fbc27e65852496ab48087bcb355321a';
    const PROXY = "https://script.google.com/macros/s/AKfycbx674hDBg15__FCk1XB2HqOuxWMNB6Y2qn7b7WATT3QMCBNb4vPQzml7uZY8MJtbalU3A/exec";
    const YT_KEY = 'AIzaSyBFNFVqguQgjyy6jQWYgtTaiUn67A2DVMY';

    let currentMembers = [];

    window.onload = fetchAssemblyList;

    async function fetchAssemblyList() {
        const comm = document.getElementById('commSelector').value;
        const status = document.getElementById('load-status');
        const tbody = document.getElementById('memberTbody');
        
        status.innerText = "ğŸ“¡ ë¡œë”© ì¤‘...";
        tbody.innerHTML = '';

        try {
            const url = `https://open.assembly.go.kr/portal/openapi/nktulghcadyhmiqxi?KEY=${ASSEMBLY_KEY}&Type=json&pIndex=1&pSize=100&DEPT_NM=${encodeURIComponent(comm)}`;
            const res = await fetch(url);
            const data = await res.json();

            if (data.nktulghcadyhmiqxi) {
                currentMembers = data.nktulghcadyhmiqxi[1].row;
                currentMembers.sort((a, b) => a.HG_NM.localeCompare(b.HG_NM, 'ko'));
                status.innerText = `âœ… ${currentMembers.length}ëª… ì™„ë£Œ`;

                tbody.innerHTML = currentMembers.map((m, idx) => `
                    <tr id="row_${idx}" onclick="handleRowClick(${idx})">
                        <td><span style="background:#eee; padding:2px 6px; border-radius:4px;">${m.JOB_RES_NM || 'ìœ„ì›'}</span></td>
                        <td style="font-weight:bold; color:var(--primary);">${m.HG_NM}</td>
                        <td>${m.POLY_NM}</td>
                        <td>${m.ORIG_NM}</td>
                    </tr>
                `).join('');
                if(currentMembers.length > 0) startMonitor(0);
            }
        } catch (e) { status.innerText = "âŒ ì‹¤íŒ¨"; }
    }

    function handleRowClick(idx) {
        startMonitor(idx);
        showModal(idx);
    }

    function startMonitor(idx) {
        document.querySelectorAll('tr').forEach(tr => tr.classList.remove('active'));
        const activeRow = document.getElementById(`row_${idx}`);
        if(activeRow) activeRow.classList.add('active');

        const m = currentMembers[idx];
        const query = `"${m.POLY_NM}" "${m.HG_NM}"`; 
        fetchNaver(query);
        fetchGoogle(query);
        fetchYoutube(query);
    }

    function showModal(idx) {
        const m = currentMembers[idx];
        document.getElementById('modalName').innerText = `${m.HG_NM} (${m.HJ_NM})`;
        document.getElementById('modalBody').innerHTML = `
            <div class="info-label">ì •ë‹¹</div><div class="info-value">${m.POLY_NM}</div>
            <div class="info-label">ì§€ì—­êµ¬</div><div class="info-value">${m.ORIG_NM}</div>
            <div class="info-label">ì „í™”ë²ˆí˜¸</div><div class="info-value">${m.ASSEM_TEL || '-'}</div>
            <div class="info-label">ì´ë©”ì¼</div><div class="info-value">${m.ASSEM_EMAIL || '-'}</div>
            <div class="info-label">ì‚¬ë¬´ì‹¤</div><div class="info-value">${m.ROOM_NO ? m.ROOM_NO + 'í˜¸' : '-'}</div>
            <hr style="grid-column: span 2; width:100%; border:0; border-top:1px solid #eee; margin:5px 0;">
            <div class="info-label">ë³´ì¢Œê´€</div><div class="info-value">${m.STAFF || '-'}</div>
            <div class="info-label">ë¹„ì„œê´€</div><div class="info-value">${m.SECRETARY || '-'}</div>
            <div class="info-label">ë¹„ì„œ</div><div class="info-value">${m.SECRETARY2 || '-'}</div>
        `;
        document.getElementById('infoModal').style.display = 'flex';
    }

    function closeModal() {
        document.getElementById('infoModal').style.display = 'none';
    }

    async function fetchNaver(q) {
        const api = `https://openapi.naver.com/v1/search/news.json?query=${encodeURIComponent(q)}&display=15&sort=date`;
        const res = await fetch(`${PROXY}?url=${encodeURIComponent(api)}`);
        const data = await res.json();
        document.getElementById('naverArea').innerHTML = (data.items || []).map(i => `
            <a href="${i.link}" target="_blank" class="item">
                <div class="item-title">${i.title.replace(/<[^>]*>?/gm, '')}</div>
                <div class="item-info" style="font-size:11px; color:#888;">${new Date(i.pubDate).toLocaleDateString()}</div>
            </a>
        `).join('') || 'ê²°ê³¼ ì—†ìŒ';
    }

    async function fetchGoogle(q) {
        const url = `https://news.google.com/rss/search?q=${encodeURIComponent(q)}&hl=ko&gl=KR&ceid=KR:ko`;
        const res = await fetch(`${PROXY}?url=${encodeURIComponent(url)}`);
        const text = await res.text();
        const xml = new DOMParser().parseFromString(text, "text/xml");
        const items = Array.from(xml.querySelectorAll("item")).slice(0, 15);
        document.getElementById('googleArea').innerHTML = items.map(i => `
            <a href="${i.querySelector("link").textContent}" target="_blank" class="item">
                <div class="item-title">${i.querySelector("title").textContent}</div>
                <div class="item-info" style="font-size:11px; color:#888;">${i.querySelector("source")?.textContent || ''}</div>
            </a>
        `).join('') || 'ê²°ê³¼ ì—†ìŒ';
    }

    async function fetchYoutube(q) {
        const url = `https://www.googleapis.com/youtube/v3/search?part=snippet&q=${encodeURIComponent(q)}&maxResults=10&order=date&type=video&key=${YT_KEY}`;
        try {
            const res = await fetch(url);
            const data = await res.json();
            document.getElementById('ytArea').innerHTML = (data.items || []).map(v => `
                <a href="https://www.youtube.com/watch?v=${v.id.videoId}" target="_blank" class="item">
                    <div class="yt-thumb" style="background-image:url('${v.snippet.thumbnails.medium.url}')"></div>
                    <div class="item-title" style="font-size:13px;">${v.snippet.title}</div>
                </a>
            `).join('') || 'ê²°ê³¼ ì—†ìŒ';
        } catch(e) { document.getElementById('ytArea').innerHTML = 'ë¡œë”© ì‹¤íŒ¨'; }
    }
</script>
</body>
</html>
