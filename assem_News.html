<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>êµ­íšŒ ìœ„ì›íšŒ í†µí•© ëª¨ë‹ˆí„°ë§</title>
    <style>
        :root { --primary: #003478; --naver: #03cf5d; --yt: #ff0000; --bg: #f4f7fa; }
        * { box-sizing: border-box; font-family: 'Pretendard', sans-serif; }
        body { background: var(--bg); margin: 0; padding: 15px; height: 100vh; display: flex; flex-direction: column; gap: 15px; overflow: hidden; }

        /* [1ë‹¨ê³„] ëª…ë‹¨ ì˜ì—­ */
        .step-1-container { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); height: 45%; min-height: 350px; display: flex; flex-direction: column; }
        .control-panel { display: flex; gap: 10px; margin-bottom: 15px; padding: 15px; background: #f1f3f5; border-radius: 8px; align-items: center; }
        .control-panel h2 { font-size: 18px; margin: 0; color: var(--primary); white-space: nowrap; }
        select { flex: 1; padding: 12px; border: 1px solid #ced4da; border-radius: 6px; font-size: 15px; font-weight: bold; cursor: pointer; }
        
        .table-wrapper { overflow: auto; flex: 1; border: 1px solid #dee2e6; border-radius: 8px; }
        table { width: 100%; border-collapse: collapse; min-width: 1800px; font-size: 13px; }
        th { background: #e9ecef; padding: 12px; border-bottom: 2px solid #dee2e6; text-align: left; position: sticky; top: 0; z-index: 10; }
        td { padding: 10px 12px; border-bottom: 1px solid #eee; white-space: nowrap; cursor: pointer; }
        tr:hover { background-color: #f1f8ff; }
        tr.active { background-color: #e8f0fe !important; font-weight: bold; border-left: 5px solid var(--primary); }
        .staff-cell { color: #555; font-size: 11px; white-space: normal; min-width: 150px; line-height: 1.4; }

        /* [2ë‹¨ê³„] ë‰´ìŠ¤ ì˜ì—­ */
        .step-2-container { flex: 1; display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; min-height: 0; }
        .monitor-col { background: #fff; border-radius: 12px; padding: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.06); display: flex; flex-direction: column; overflow: hidden; }
        .col-title { font-weight: bold; font-size: 1.1rem; margin-bottom: 10px; padding-bottom: 8px; border-bottom: 1px solid #eee; }
        .content-scroll { flex: 1; overflow-y: auto; }

        .item { padding: 12px 0; border-bottom: 1px solid #f1f1f1; text-decoration: none; color: inherit; display: block; }
        .item-title { font-size: 0.95rem; font-weight: 600; line-height: 1.4; margin-bottom: 4px; }
        .yt-thumb { width: 100%; aspect-ratio: 16/9; background-size: cover; border-radius: 8px; margin-bottom: 8px; background-color: #000; }
    </style>
</head>
<body>

<div class="step-1-container">
    <div class="control-panel">
        <h2>ğŸ›ï¸ ìœ„ì›íšŒ ì„ íƒ</h2>
        <select id="commSelector" onchange="fetchAssemblyList()">
            <optgroup label="ìƒì„ìœ„ì›íšŒ">
                <option value="êµ­íšŒìš´ì˜ìœ„ì›íšŒ">êµ­íšŒìš´ì˜ìœ„ì›íšŒ</option>
                <option value="ë²•ì œì‚¬ë²•ìœ„ì›íšŒ">ë²•ì œì‚¬ë²•ìœ„ì›íšŒ</option>
                <option value="ì •ë¬´ìœ„ì›íšŒ">ì •ë¬´ìœ„ì›íšŒ</option>
                <option value="ê¸°íšì¬ì •ìœ„ì›íšŒ">ê¸°íšì¬ì •ìœ„ì›íšŒ</option>
                <option value="êµìœ¡ìœ„ì›íšŒ">êµìœ¡ìœ„ì›íšŒ</option>
                <option value="ê³¼í•™ê¸°ìˆ ì •ë³´ë°©ì†¡í†µì‹ ìœ„ì›íšŒ">ê³¼í•™ê¸°ìˆ ì •ë³´ë°©ì†¡í†µì‹ ìœ„ì›íšŒ</option>
                <option value="ì™¸êµí†µì¼ìœ„ì›íšŒ">ì™¸êµí†µì¼ìœ„ì›íšŒ</option>
                <option value="êµ­ë°©ìœ„ì›íšŒ">êµ­ë°©ìœ„ì›íšŒ</option>
                <option value="í–‰ì •ì•ˆì „ìœ„ì›íšŒ">í–‰ì •ì•ˆì „ìœ„ì›íšŒ</option>
                <option value="ë¬¸í™”ì²´ìœ¡ê´€ê´‘ìœ„ì›íšŒ" selected>ë¬¸í™”ì²´ìœ¡ê´€ê´‘ìœ„ì›íšŒ</option>
                <option value="ë†ë¦¼ì¶•ì‚°ì‹í’ˆí•´ì–‘ìˆ˜ì‚°ìœ„ì›íšŒ">ë†ë¦¼ì¶•ì‚°ì‹í’ˆí•´ì–‘ìˆ˜ì‚°ìœ„ì›íšŒ</option>
                <option value="ì‚°ì—…í†µìƒìì›ì¤‘ì†Œë²¤ì²˜ê¸°ì—…ìœ„ì›íšŒ">ì‚°ì—…í†µìƒìì›ì¤‘ì†Œë²¤ì²˜ê¸°ì—…ìœ„ì›íšŒ</option>
                <option value="ë³´ê±´ë³µì§€ìœ„ì›íšŒ">ë³´ê±´ë³µì§€ìœ„ì›íšŒ</option>
                <option value="í™˜ê²½ë…¸ë™ìœ„ì›íšŒ">í™˜ê²½ë…¸ë™ìœ„ì›íšŒ</option>
                <option value="êµ­í† êµí†µìœ„ì›íšŒ">êµ­í† êµí†µìœ„ì›íšŒ</option>
                <option value="ì •ë³´ìœ„ì›íšŒ">ì •ë³´ìœ„ì›íšŒ</option>
                <option value="ì—¬ì„±ê°€ì¡±ìœ„ì›íšŒ">ì—¬ì„±ê°€ì¡±ìœ„ì›íšŒ</option>
            </optgroup>
            <optgroup label="íŠ¹ë³„ìœ„ì›íšŒ">
                <option value="ì˜ˆì‚°ê²°ì‚°íŠ¹ë³„ìœ„ì›íšŒ">ì˜ˆì‚°ê²°ì‚°íŠ¹ë³„ìœ„ì›íšŒ</option>
                <option value="ìœ¤ë¦¬íŠ¹ë³„ìœ„ì›íšŒ">ìœ¤ë¦¬íŠ¹ë³„ìœ„ì›íšŒ</option>
                <option value="ì¸ì‚¬ì²­ë¬¸íŠ¹ë³„ìœ„ì›íšŒ">ì¸ì‚¬ì²­ë¬¸íŠ¹ë³„ìœ„ì›íšŒ</option>
            </optgroup>
        </select>
        <span id="load-status" style="font-size:13px; color:var(--primary); font-weight:bold;"></span>
    </div>

    <div class="table-wrapper">
        <table>
            <thead>
                <tr>
                    <th>ìˆœë²ˆ</th>
                    <th>ìœ„ì›íšŒëª…</th>
                    <th>êµ¬ì„±</th>
                    <th>ì„±ëª…</th>
                    <th>ì„±ëª…(í•œì)</th>
                    <th>ì •ë‹¹</th>
                    <th>ì„ ê±°êµ¬</th>
                    <th>ì „í™”ë²ˆí˜¸</th>
                    <th>ì´ë©”ì¼</th>
                    <th>í˜¸ì‹¤</th>
                    <th>ë³´ì¢Œê´€</th>
                    <th>ë¹„ì„œê´€</th>
                    <th>ë¹„ì„œ</th>
                </tr>
            </thead>
            <tbody id="memberTbody"></tbody>
        </table>
    </div>
</div>

<div class="step-2-container">
    <div class="monitor-col"><div class="col-title" style="color:var(--naver)">ğŸŸ¢ ë„¤ì´ë²„ ë‰´ìŠ¤</div><div id="naverArea" class="content-scroll"></div></div>
    <div class="monitor-col"><div class="col-title" style="color:var(--primary)">ğŸ”µ êµ¬ê¸€ ë‰´ìŠ¤</div><div id="googleArea" class="content-scroll"></div></div>
    <div class="monitor-col"><div class="col-title" style="color:var(--yt)">ğŸ¬ ìœ íŠœë¸Œ</div><div id="ytArea" class="content-scroll"></div></div>
</div>

<script>
    const ASSEMBLY_KEY = '4fbc27e65852496ab48087bcb355321a';
    const PROXY = "https://script.google.com/macros/s/AKfycbx674hDBg15__FCk1XB2HqOuxWMNB6Y2qn7b7WATT3QMCBNb4vPQzml7uZY8MJtbalU3A/exec";
    const YT_KEY = 'AIzaSyBFNFVqguQgjyy6jQWYgtTaiUn67A2DVMY';

    let currentMembers = [];

    window.onload = fetchAssemblyList;

    async function fetchAssemblyList() {
        const comm = document.getElementById('commSelector').value;
        const status = document.getElementById('load-status');
        const tbody = document.getElementById('memberTbody');
        
        status.innerText = "ğŸ“¡ ë°ì´í„° ë¡œë”© ì¤‘...";
        tbody.innerHTML = '';

        try {
            // êµ­íšŒ APIì—ì„œ DEPT_NM(ìœ„ì›íšŒëª…)ìœ¼ë¡œ ì¿¼ë¦¬
            const url = `https://open.assembly.go.kr/portal/openapi/nktulghcadyhmiqxi?KEY=${ASSEMBLY_KEY}&Type=json&pIndex=1&pSize=100&DEPT_NM=${encodeURIComponent(comm)}`;
            const res = await fetch(url);
            const data = await res.json();

            if (data.nktulghcadyhmiqxi) {
                currentMembers = data.nktulghcadyhmiqxi[1].row;
                // ì„±ëª… ê¸°ì¤€ ê°€ë‚˜ë‹¤ìˆœ ì •ë ¬
                currentMembers.sort((a, b) => a.HG_NM.localeCompare(b.HG_NM, 'ko'));
                
                status.innerText = `âœ… ${currentMembers.length}ëª… ë¡œë“œ ì™„ë£Œ`;

                tbody.innerHTML = currentMembers.map((m, idx) => `
                    <tr id="row_${idx}" onclick="startMonitor(${idx})">
                        <td>${idx + 1}</td>
                        <td>${m.DEPT_NM}</td>
                        <td><span style="background:#eee; padding:2px 6px; border-radius:4px;">${m.JOB_RES_NM || 'ìœ„ì›'}</span></td>
                        <td style="font-weight:bold;">${m.HG_NM}</td>
                        <td>${m.HJ_NM || '-'}</td>
                        <td>${m.POLY_NM}</td>
                        <td>${m.ORIG_NM}</td>
                        <td style="color:var(--primary); font-weight:500;">${m.ASSEM_TEL || '-'}</td>
                        <td>${m.ASSEM_EMAIL || '-'}</td>
                        <td>${m.ROOM_NO ? m.ROOM_NO + 'í˜¸' : '-'}</td>
                        <td class="staff-cell">${m.STAFF || '-'}</td>
                        <td class="staff-cell">${m.SECRETARY || '-'}</td>
                        <td class="staff-cell">${m.SECRETARY2 || '-'}</td>
                    </tr>
                `).join('');

                if(currentMembers.length > 0) startMonitor(0);
            }
        } catch (e) { status.innerText = "âŒ ë¡œë“œ ì‹¤íŒ¨"; }
    }

    function startMonitor(idx) {
        document.querySelectorAll('tr').forEach(tr => tr.classList.remove('active'));
        document.getElementById(`row_${idx}`).classList.add('active');

        const m = currentMembers[idx];
        const query = `"${m.POLY_NM}" "${m.HG_NM}"`; 

        fetchNaver(query);
        fetchGoogle(query);
        fetchYoutube(query);
    }

    async function fetchNaver(q) {
        const api = `https://openapi.naver.com/v1/search/news.json?query=${encodeURIComponent(q)}&display=15&sort=date`;
        const res = await fetch(`${PROXY}?url=${encodeURIComponent(api)}`);
        const data = await res.json();
        document.getElementById('naverArea').innerHTML = (data.items || []).map(i => `
            <a href="${i.link}" target="_blank" class="item">
                <div class="item-title">${i.title.replace(/<[^>]*>?/gm, '')}</div>
                <div class="item-info" style="font-size:11px; color:#888;">${new Date(i.pubDate).toLocaleDateString()}</div>
            </a>
        `).join('') || 'ê²°ê³¼ ì—†ìŒ';
    }

    async function fetchGoogle(q) {
        const url = `https://news.google.com/rss/search?q=${encodeURIComponent(q)}&hl=ko&gl=KR&ceid=KR:ko`;
        const res = await fetch(`${PROXY}?url=${encodeURIComponent(url)}`);
        const text = await res.text();
        const xml = new DOMParser().parseFromString(text, "text/xml");
        const items = Array.from(xml.querySelectorAll("item")).slice(0, 15);
        document.getElementById('googleArea').innerHTML = items.map(i => `
            <a href="${i.querySelector("link").textContent}" target="_blank" class="item">
                <div class="item-title">${i.querySelector("title").textContent}</div>
                <div class="item-info" style="font-size:11px; color:#888;">${i.querySelector("source")?.textContent || ''}</div>
            </a>
        `).join('') || 'ê²°ê³¼ ì—†ìŒ';
    }

    async function fetchYoutube(q) {
        const url = `https://www.googleapis.com/youtube/v3/search?part=snippet&q=${encodeURIComponent(q)}&maxResults=10&order=date&type=video&key=${YT_KEY}`;
        try {
            const res = await fetch(url);
            const data = await res.json();
            document.getElementById('ytArea').innerHTML = (data.items || []).map(v => `
                <a href="https://www.youtube.com/watch?v=${v.id.videoId}" target="_blank" class="item">
                    <div class="yt-thumb" style="background-image:url('${v.snippet.thumbnails.medium.url}')"></div>
                    <div class="item-title" style="font-size:13px;">${v.snippet.title}</div>
                </a>
            `).join('') || 'ê²°ê³¼ ì—†ìŒ';
        } catch(e) { document.getElementById('ytArea').innerHTML = 'ë¡œë”© ì‹¤íŒ¨'; }
    }
</script>
</body>
</html>