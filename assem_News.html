<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>êµ­íšŒ ìœ„ì›íšŒ í†µí•© ëª¨ë‹ˆí„°ë§</title>
    <style>
        :root { --primary: #003478; --naver: #03cf5d; --yt: #ff0000; --bg: #f4f7fa; }
        * { box-sizing: border-box; font-family: 'Pretendard', sans-serif; }
        body { background: var(--bg); margin: 0; padding: 15px; height: 100vh; display: flex; flex-direction: column; gap: 15px; overflow: hidden; }

        /* [ë°ìŠ¤í¬íƒ‘ ì „ìš© ìŠ¤íƒ€ì¼] */
        .step-1-container { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); height: 45%; min-height: 350px; display: flex; flex-direction: column; }
        .control-panel { display: flex; gap: 10px; margin-bottom: 15px; padding: 15px; background: #f1f3f5; border-radius: 8px; align-items: center; }
        .control-panel h2 { font-size: 18px; margin: 0; color: var(--primary); white-space: nowrap; }
        select { flex: 1; padding: 12px; border: 1px solid #ced4da; border-radius: 6px; font-size: 15px; font-weight: bold; cursor: pointer; }
        .table-wrapper { overflow: auto; flex: 1; border: 1px solid #dee2e6; border-radius: 8px; }
        table { width: 100%; border-collapse: collapse; min-width: 1800px; font-size: 13px; }
        th { background: #e9ecef; padding: 12px; border-bottom: 2px solid #dee2e6; text-align: left; position: sticky; top: 0; z-index: 10; }
        td { padding: 10px 12px; border-bottom: 1px solid #eee; white-space: nowrap; cursor: pointer; }
        tr:hover { background-color: #f1f8ff; }
        tr.active { background-color: #e8f0fe !important; font-weight: bold; border-left: 5px solid var(--primary); }
        .staff-cell { color: #555; font-size: 11px; white-space: normal; min-width: 150px; line-height: 1.4; }

        .step-2-container { flex: 1; display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; min-height: 0; }
        .monitor-col { background: #fff; border-radius: 12px; padding: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.06); display: flex; flex-direction: column; overflow: hidden; }
        .col-title { font-weight: bold; font-size: 1.1rem; margin-bottom: 10px; padding-bottom: 8px; border-bottom: 1px solid #eee; }
        .content-scroll { flex: 1; overflow-y: auto; }

        .item { padding: 12px 0; border-bottom: 1px solid #f1f1f1; text-decoration: none; color: inherit; display: block; }
        .item-title { font-size: 0.95rem; font-weight: 600; line-height: 1.4; margin-bottom: 4px; }
        .yt-thumb { width: 100%; aspect-ratio: 16/9; background-size: cover; border-radius: 8px; margin-bottom: 8px; background-color: #000; }

        /* ëª¨ë°”ì¼ìš© íƒ­ ë°” (PCì—ì„  ìˆ¨ê¹€) */
        .mobile-nav { display: none; }

        /* [ëª¨ë°”ì¼ ì „ìš© ìŠ¤íƒ€ì¼ - 768px ë¯¸ë§Œ] */
        @media (max-width: 768px) {
            body { padding: 0; gap: 0; }
            .step-1-container { height: 100%; border-radius: 0; box-shadow: none; padding: 10px; }
            .control-panel { padding: 10px; margin-bottom: 10px; }
            .control-panel h2 { font-size: 16px; }
            
            /* í…Œì´ë¸” ëŒ€ì‹  ì¹´ë“œ ë¦¬ìŠ¤íŠ¸ë¡œ ì „í™˜ */
            .table-wrapper { border: none; }
            table thead { display: none; } /* í—¤ë” ìˆ¨ê¹€ */
            table, tbody, tr, td { display: block; width: 100%; min-width: auto; }
            tr { background: white; border: 1px solid #eee; border-radius: 10px; margin-bottom: 10px; padding: 12px; }
            tr.active { border: 2px solid var(--primary); }
            td { border: none; padding: 2px 0; white-space: normal; }
            
            /* íŠ¹ì • ì…€ë§Œ ë³´ì´ê²Œ í•˜ê±°ë‚˜ ìŠ¤íƒ€ì¼ ì¡°ì • */
            td:not(:nth-child(3)):not(:nth-child(4)):not(:nth-child(6)):not(:nth-child(7)):not(:nth-child(8)) { display: none; }
            td:nth-child(4) { font-size: 18px; color: #000; } /* ì„±ëª… */
            td:nth-child(6) { display: inline-block; font-size: 12px; color: #666; margin-right: 5px; } /* ì •ë‹¹ */
            td:nth-child(7) { display: inline-block; font-size: 12px; color: #666; } /* ì§€ì—­êµ¬ */
            td:nth-child(8) { display: block; margin-top: 5px; font-weight: bold; } /* ì „í™”ë²ˆí˜¸ */

            /* ë‰´ìŠ¤ ì˜ì—­ íƒ­ êµ¬ì¡°ë¡œ ë³€ê²½ */
            .step-2-container { display: none; padding: 10px; background: white; }
            .step-2-container.active { display: block; height: 100%; overflow-y: auto; }
            .monitor-col { box-shadow: none; padding: 0; margin-bottom: 20px; }

            /* í•˜ë‹¨ ê³ ì • íƒ­ë°” */
            .mobile-nav { 
                display: flex; position: fixed; bottom: 0; width: 100%; background: #fff; 
                border-top: 1px solid #ddd; height: 60px; z-index: 1000;
                padding-bottom: env(safe-area-inset-bottom);
            }
            .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 12px; color: #888; cursor: pointer; }
            .nav-item.active { color: var(--primary); font-weight: bold; }
        }
    </style>
</head>
<body>

<div id="section-1" class="step-1-container">
    <div class="control-panel">
        <h2>ğŸ›ï¸ ìœ„ì›íšŒ</h2>
        <select id="commSelector" onchange="fetchAssemblyList()">
            <option value="ë¬¸í™”ì²´ìœ¡ê´€ê´‘ìœ„ì›íšŒ" selected>ë¬¸í™”ì²´ìœ¡ê´€ê´‘ìœ„ì›íšŒ</option>
            <option value="êµ­íšŒìš´ì˜ìœ„ì›íšŒ">êµ­íšŒìš´ì˜ìœ„ì›íšŒ</option>
            <option value="ë²•ì œì‚¬ë²•ìœ„ì›íšŒ">ë²•ì œì‚¬ë²•ìœ„ì›íšŒ</option>
            <option value="ì •ë¬´ìœ„ì›íšŒ">ì •ë¬´ìœ„ì›íšŒ</option>
            <option value="ë³´ê±´ë³µì§€ìœ„ì›íšŒ">ë³´ê±´ë³µì§€ìœ„ì›íšŒ</option>
            </select>
        <span id="load-status" style="font-size:11px;"></span>
    </div>

    <div class="table-wrapper">
        <table>
            <thead>
                <tr>
                    <th>ìˆœë²ˆ</th><th>ìœ„ì›íšŒëª…</th><th>êµ¬ì„±</th><th>ì„±ëª…</th><th>ì„±ëª…(í•œì)</th><th>ì •ë‹¹</th><th>ì„ ê±°êµ¬</th><th>ì „í™”ë²ˆí˜¸</th><th>ì´ë©”ì¼</th><th>í˜¸ì‹¤</th><th>ë³´ì¢Œê´€</th><th>ë¹„ì„œê´€</th><th>ë¹„ì„œ</th>
                </tr>
            </thead>
            <tbody id="memberTbody"></tbody>
        </table>
    </div>
</div>

<div id="section-2" class="step-2-container">
    <div class="monitor-col"><div class="col-title" style="color:var(--naver)">ğŸŸ¢ ë„¤ì´ë²„ ë‰´ìŠ¤</div><div id="naverArea" class="content-scroll"></div></div>
    <div class="monitor-col"><div class="col-title" style="color:var(--primary)">ğŸ”µ êµ¬ê¸€ ë‰´ìŠ¤</div><div id="googleArea" class="content-scroll"></div></div>
    <div class="monitor-col"><div class="col-title" style="color:var(--yt)">ğŸ¬ ìœ íŠœë¸Œ</div><div id="ytArea" class="content-scroll"></div></div>
</div>

<nav class="mobile-nav">
    <div class="nav-item active" onclick="showSection(1)">ğŸ‘¤ ëª©ë¡</div>
    <div class="nav-item" onclick="showSection(2)">ğŸ“° ë‰´ìŠ¤</div>
</nav>

<script>
    const ASSEMBLY_KEY = '4fbc27e65852496ab48087bcb355321a';
    const PROXY = "https://script.google.com/macros/s/AKfycbx674hDBg15__FCk1XB2HqOuxWMNB6Y2qn7b7WATT3QMCBNb4vPQzml7uZY8MJtbalU3A/exec";
    const YT_KEY = 'AIzaSyBFNFVqguQgjyy6jQWYgtTaiUn67A2DVMY';

    let currentMembers = [];

    window.onload = fetchAssemblyList;

    async function fetchAssemblyList() {
        const comm = document.getElementById('commSelector').value;
        const status = document.getElementById('load-status');
        const tbody = document.getElementById('memberTbody');
        status.innerText = "ë¡œë”©ì¤‘...";
        try {
            const url = `https://open.assembly.go.kr/portal/openapi/nktulghcadyhmiqxi?KEY=${ASSEMBLY_KEY}&Type=json&pIndex=1&pSize=100&DEPT_NM=${encodeURIComponent(comm)}`;
            const res = await fetch(url);
            const data = await res.json();
            if (data.nktulghcadyhmiqxi) {
                currentMembers = data.nktulghcadyhmiqxi[1].row;
                currentMembers.sort((a, b) => a.HG_NM.localeCompare(b.HG_NM, 'ko'));
                status.innerText = `âœ… ${currentMembers.length}ëª…`;
                tbody.innerHTML = currentMembers.map((m, idx) => `
                    <tr id="row_${idx}" onclick="startMonitor(${idx})">
                        <td>${idx + 1}</td>
                        <td>${m.DEPT_NM}</td>
                        <td>${m.JOB_RES_NM || 'ìœ„ì›'}</td>
                        <td style="font-weight:bold;">${m.HG_NM}</td>
                        <td>${m.HJ_NM || '-'}</td>
                        <td>${m.POLY_NM}</td>
                        <td>${m.ORIG_NM}</td>
                        <td style="color:var(--primary);">${m.ASSEM_TEL || '-'}</td>
                        <td>${m.ASSEM_EMAIL || '-'}</td>
                        <td>${m.ROOM_NO ? m.ROOM_NO || : '-'}</td>
                        <td class="staff-cell">${m.STAFF || '-'}</td>
                        <td class="staff-cell">${m.SECRETARY || '-'}</td>
                        <td class="staff-cell">${m.SECRETARY2 || '-'}</td>
                    </tr>
                `).join('');
                if(currentMembers.length > 0) startMonitor(0, false);
            }
        } catch (e) { status.innerText = "âŒ ì‹¤íŒ¨"; }
    }

    function startMonitor(idx, autoJump = true) {
        document.querySelectorAll('tr').forEach(tr => tr.classList.remove('active'));
        const targetRow = document.getElementById(`row_${idx}`);
        if(targetRow) targetRow.classList.add('active');

        const m = currentMembers[idx];
        const query = `"${m.POLY_NM}" "${m.HG_NM}"`; 

        fetchNaver(query);
        fetchGoogle(query);
        fetchYoutube(query);

        // ëª¨ë°”ì¼ì—ì„œ ì˜ì› í´ë¦­ ì‹œ ë‰´ìŠ¤ ì„¹ì…˜ìœ¼ë¡œ ìë™ ì í”„
        if(window.innerWidth <= 768 && autoJump) {
            showSection(2);
        }
    }

    function showSection(num) {
        if(window.innerWidth > 768) return; // PCì—ì„  ì‘ë™ ì•ˆí•¨
        
        document.getElementById('section-1').style.display = (num === 1) ? 'flex' : 'none';
        document.getElementById('section-2').style.display = (num === 2) ? 'block' : 'none';
        document.getElementById('section-2').classList.toggle('active', num === 2);
        
        const navs = document.querySelectorAll('.nav-item');
        navs.forEach((n, i) => n.classList.toggle('active', i === num-1));
    }

    // [ê¸°ì¡´ Fetch í•¨ìˆ˜ë“¤ ë™ì¼í•˜ê²Œ ìœ ì§€]
    async function fetchNaver(q) {
        const api = `https://openapi.naver.com/v1/search/news.json?query=${encodeURIComponent(q)}&display=15&sort=date`;
        const res = await fetch(`${PROXY}?url=${encodeURIComponent(api)}`);
        const data = await res.json();
        document.getElementById('naverArea').innerHTML = (data.items || []).map(i => `<a href="${i.link}" target="_blank" class="item"><div class="item-title">${i.title.replace(/<[^>]*>?/gm, '')}</div><div class="item-info" style="font-size:11px; color:#888;">${new Date(i.pubDate).toLocaleDateString()}</div></a>`).join('') || 'ê²°ê³¼ ì—†ìŒ';
    }
    async function fetchGoogle(q) {
        const url = `https://news.google.com/rss/search?q=${encodeURIComponent(q)}&hl=ko&gl=KR&ceid=KR:ko`;
        const res = await fetch(`${PROXY}?url=${encodeURIComponent(url)}`);
        const text = await res.text();
        const xml = new DOMParser().parseFromString(text, "text/xml");
        const items = Array.from(xml.querySelectorAll("item")).slice(0, 15);
        document.getElementById('googleArea').innerHTML = items.map(i => `<a href="${i.querySelector("link").textContent}" target="_blank" class="item"><div class="item-title">${i.querySelector("title").textContent}</div><div class="item-info" style="font-size:11px; color:#888;">${i.querySelector("source")?.textContent || ''}</div></a>`).join('') || 'ê²°ê³¼ ì—†ìŒ';
    }
    async function fetchYoutube(q) {
        const url = `https://www.googleapis.com/youtube/v3/search?part=snippet&q=${encodeURIComponent(q)}&maxResults=10&order=date&type=video&key=${YT_KEY}`;
        try {
            const res = await fetch(url);
            const data = await res.json();
            document.getElementById('ytArea').innerHTML = (data.items || []).map(v => `<a href="https://www.youtube.com/watch?v=${v.id.videoId}" target="_blank" class="item"><div class="yt-thumb" style="background-image:url('${v.snippet.thumbnails.medium.url}')"></div><div class="item-title" style="font-size:13px;">${v.snippet.title}</div></a>`).join('') || 'ê²°ê³¼ ì—†ìŒ';
        } catch(e) { document.getElementById('ytArea').innerHTML = 'ë¡œë”© ì‹¤íŒ¨'; }
    }
</script>
</body>
</html>

