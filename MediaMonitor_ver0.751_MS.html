<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>KPF í†µí•© ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ (v0.91_Search)</title>
    <style>
        :root { --primary: #004085; --naver: #03cf5d; --yt: #ff0000; --bg: #f4f7fa; }
        * { box-sizing: border-box; }
        body { font-family: 'Pretendard', sans-serif; background: var(--bg); margin: 0; padding: 15px; height: 100vh; overflow: hidden; }
        .dashboard-grid { display: grid; grid-template-columns: 320px 1fr 1fr 380px; gap: 12px; height: calc(100vh - 30px); }
        .column { display: flex; flex-direction: column; gap: 12px; height: 100%; min-height: 0; }
        .card { background: #fff; border-radius: 12px; padding: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.06); display: flex; flex-direction: column; height: 100%; min-height: 0; }
        .title { font-size: 1.05rem; font-weight: bold; margin-bottom: 10px; padding-bottom: 8px; border-bottom: 2px solid #eee; display: flex; justify-content: space-between; align-items: center; flex-shrink: 0; }
        
        /* ê²°ê³¼ ë‚´ ê²€ìƒ‰ì°½ ìŠ¤íƒ€ì¼ */
        .local-search { width: 100%; padding: 8px; margin-bottom: 10px; border: 1px solid #e0e0e0; border-radius: 6px; font-size: 0.8rem; background: #fafafa; }
        .local-search:focus { border-color: var(--primary); outline: none; background: #fff; }

        .scroll-area { flex-grow: 1; overflow-y: auto; padding-right: 8px; min-height: 0; }
        .scroll-area::-webkit-scrollbar { width: 6px; }
        .scroll-area::-webkit-scrollbar-thumb { background: #ccc; border-radius: 10px; }

        .date-filter { display: flex; gap: 5px; margin-bottom: 12px; align-items: center; background: #f9f9f9; padding: 8px; border-radius: 8px; }
        .date-filter input { flex: 1; padding: 5px; border: 1px solid #ddd; border-radius: 4px; font-size: 0.75rem; color: #555; }

        .filter-group { display: flex; flex-direction: column; gap: 4px; margin-bottom: 10px; overflow-y: auto; max-height: 450px; padding-right: 5px; }
        .filter-btn { padding: 8px 10px; border: 1px solid #ddd; background: #fff; border-radius: 6px; font-size: 0.75rem; text-align: left; cursor: pointer; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .filter-btn:hover { background: #f0f4f8; }
        .filter-btn.active { background: var(--primary); color: #fff; border-color: var(--primary); font-weight: bold; }

        .item { padding: 12px 0; border-bottom: 1px solid #f1f1f1; text-decoration: none; color: inherit; display: block; }
        .item:hover { background-color: #fafafa; }
        .item-title { font-size: 0.9rem; font-weight: bold; line-height: 1.4; margin-bottom: 4px; }
        .item-info { font-size: 0.75rem; color: #888; display: flex; justify-content: space-between; align-items: center; }
        
        .press-badge { color: var(--naver); font-weight: bold; margin-right: 5px; background: #f0fff4; padding: 2px 5px; border-radius: 3px; }
        
        .pagination { display: flex; justify-content: center; align-items: center; gap: 10px; padding-top: 10px; flex-shrink: 0; border-top: 1px solid #eee; margin-top: 5px; }
        .btn-page { padding: 4px 10px; border: 1px solid #ddd; background: #fff; font-size: 0.75rem; cursor: pointer; border-radius: 4px; }
        .page-num { font-size: 0.85rem; font-weight: bold; color: var(--primary); }

        .sort-tabs { display: flex; gap: 4px; }
        .btn-sort { font-size: 0.7rem; padding: 4px 8px; border: 1px solid #ddd; background: #fff; border-radius: 4px; cursor: pointer; color: #777; transition: all 0.2s; }
        .btn-sort.active { color: white !important; background: #333 !important; border-color: #333 !important; font-weight: bold; }
        
        .yt-card { margin-bottom: 15px; text-decoration: none; color: inherit; display: block; }
        .yt-thumb { width: 100%; aspect-ratio: 16/9; background-size: cover; border-radius: 6px; margin-bottom: 6px; background-color: #000; }
    </style>
</head>
<body>

<div class="dashboard-grid">
    <div class="column">
        <div class="card">
            <div class="title">ğŸ¯ ëª¨ë‹ˆí„°ë§ ì„¤ì •</div>
            <div class="date-filter">
                <input type="date" id="startDate">
                <span>~</span>
                <input type="date" id="endDate">
            </div>
            <div class="filter-group" id="filterGroup">
                <button class="filter-btn active" onclick="applyFilter(0)">1. ì¬ë‹¨ ì „ì²´</button>
                <button class="filter-btn" onclick="applyFilter(1)">2. ì‹ ë¬¸ë²•</button>
                <button class="filter-btn" onclick="applyFilter(2)">3. ì •ë¶€ê´‘ê³ </button>
                <button class="filter-btn" onclick="applyFilter(3)">4. ë¯¸ë””ì–´ê±°ë²„ë„ŒìŠ¤</button>
                <button class="filter-btn" onclick="applyFilter(4)">5. ë¯¸ë””ì–´ë¦¬í„°ëŸ¬ì‹œ</button>
                <button class="filter-btn" onclick="applyFilter(5)">6. ë¯¸ë””ì–´ë°”ìš°ì²˜/ê°œí˜</button>
                <button class="filter-btn" onclick="applyFilter(6)">7. ìœ ê´€ê¸°ê´€/ìœ„ì›íšŒ</button>
                <button class="filter-btn" onclick="applyFilter(7)">8. ì£¼ìš” ì¸ë¬¼</button>
                <button class="filter-btn" onclick="applyFilter(8)">9. ê³µê³µê¸°ê´€</button>
                <button class="filter-btn" onclick="applyFilter(9)">10. êµ­íšŒ/ë¶€ì²˜/ì‹ ë¬¸</button>
            </div>
            <input type="text" id="queryInput" style="width:100%; padding:10px; margin-bottom:8px; border:1px solid #ddd; border-radius:6px; font-size: 0.8rem;">
            <button class="btn-page" style="width:100%; background:#333; color:#fff; font-weight:bold; padding:10px;" onclick="fetchAll()">ì¡°íšŒ ê²°ê³¼ ì—…ë°ì´íŠ¸</button>
        </div>
    </div>

    <div class="column">
        <div class="card">
            <div class="title" style="color:var(--naver)"><span>ğŸŸ¢ ë„¤ì´ë²„ ë‰´ìŠ¤</span>
                <div class="sort-tabs">
                    <button id="nSortDate" class="btn-sort active" onclick="setNaverSort('date')">ìµœì‹ ìˆœ</button>
                    <button id="nSortSim" class="btn-sort" onclick="setNaverSort('sim')">ê´€ë ¨ìˆœ</button>
                </div>
            </div>
            <input type="text" class="local-search" placeholder="ê²°ê³¼ ë‚´ ì¬ê²€ìƒ‰ (ì œëª©)..." onkeyup="reSearchList('naverList', this.value)">
            <div id="naverList" class="scroll-area"></div>
            <div class="pagination">
                <button class="btn-page" onclick="changeNPage(-1)">ì´ì „</button>
                <span id="nPageNum" class="page-num">1</span>
                <button class="btn-page" onclick="changeNPage(1)">ë‹¤ìŒ</button>
            </div>
        </div>
    </div>

    <div class="column">
        <div class="card">
            <div class="title" style="color:var(--primary)"><span>ğŸ”µ êµ¬ê¸€ ë‰´ìŠ¤</span>
                <div class="sort-tabs">
                    <button id="gSortDate" class="btn-sort active" onclick="setGoogleSort('date')">ìµœì‹ ìˆœ</button>
                    <button id="gSortSim" class="btn-sort" onclick="setGoogleSort('relevance')">ê´€ë ¨ìˆœ</button>
                </div>
            </div>
            <input type="text" class="local-search" placeholder="ê²°ê³¼ ë‚´ ì¬ê²€ìƒ‰ (ì œëª©)..." onkeyup="reSearchList('googleList', this.value)">
            <div id="googleList" class="scroll-area"></div>
            <div class="pagination">
                <button class="btn-page" onclick="changeGPage(-1)">ì´ì „</button>
                <span id="gPageNum" class="page-num">1</span>
                <button class="btn-page" onclick="changeGPage(1)">ë‹¤ìŒ</button>
            </div>
        </div>
    </div>

    <div class="column">
        <div class="card">
            <div class="title" style="color:var(--yt)"><span>ğŸ¬ ìœ íŠœë¸Œ</span>
                <div class="sort-tabs">
                    <button id="ySortDate" class="btn-sort active" onclick="setYoutubeSort('date')">ìµœì‹ ìˆœ</button>
                    <button id="ySortSim" class="btn-sort" onclick="setYoutubeSort('relevance')">ê´€ë ¨ìˆœ</button>
                </div>
            </div>
            <input type="text" class="local-search" placeholder="ê²°ê³¼ ë‚´ ì¬ê²€ìƒ‰ (ì œëª©)..." onkeyup="reSearchList('ytList', this.value)">
            <div id="ytList" class="scroll-area"></div>
        </div>
    </div>
</div>

<script>
    const NAVER_ID = 'psW8xkUHR2KH4qPK9eBH';
    const NAVER_SECRET = '_8eXzLfqva';
    const GOOGLE_API_KEY = 'AIzaSyBFNFVqguQgjyy6jQWYgtTaiUn67A2DVMY';
    const PROXY = "https://corsproxy.io/?"; 

    const filterKeywords = [
        "í•œêµ­ì–¸ë¡ ì§„í¥ì¬ë‹¨ | ì–¸ë¡ ì§„í¥ì¬ë‹¨ | ì–¸ë¡ ì¬ë‹¨",
        "(í•œêµ­ì–¸ë¡ ì§„í¥ì¬ë‹¨ | ì–¸ë¡ ì§„í¥ì¬ë‹¨ | ì–¸ë¡ ì¬ë‹¨) ì‹ ë¬¸ë²•",
        "(í•œêµ­ì–¸ë¡ ì§„í¥ì¬ë‹¨ | ì–¸ë¡ ì§„í¥ì¬ë‹¨ | ì–¸ë¡ ì¬ë‹¨) ì •ë¶€ê´‘ê³ ",
        "(í•œêµ­ì–¸ë¡ ì§„í¥ì¬ë‹¨ | ì–¸ë¡ ì§„í¥ì¬ë‹¨ | ì–¸ë¡ ì¬ë‹¨) ë¯¸ë””ì–´ê±°ë²„ë„ŒìŠ¤",
        "(í•œêµ­ì–¸ë¡ ì§„í¥ì¬ë‹¨ | ì–¸ë¡ ì§„í¥ì¬ë‹¨ | ì–¸ë¡ ì¬ë‹¨) ë¯¸ë””ì–´ë¦¬í„°ëŸ¬ì‹œ",
        "ë¯¸ë””ì–´ë°”ìš°ì²˜ | ë¯¸ë””ì–´íŠ¹ìœ„ | ì–¸ë¡ ì§„í¥ê¸°ê¸ˆ | ì§€ì—­ì‹ ë¬¸ë°œì „ê¸°ê¸ˆ | ì–¸ë¡ ë…¸ì¡° | ì–¸ë¡ ì •ì±… | ì–¸ë¡ ê°œí˜",
        "ë¬¸ì²´ìœ„ | ì„¸ì¢…í”„ë ˆìŠ¤ì„¼í„° | ë‰´ìŠ¤ì œíœ´í‰ê°€ìœ„ì›íšŒ | ì œí‰ìœ„ | ì‹ ë¬¸ìœ¤ë¦¬ìœ„ì›íšŒ | ê¹€íš¨ì¬",
        "ì˜¤ì„¸ìš± | ë°•ì˜í  | ì§„ë¯¼ì •",
        "ê³µê³µê¸°ê´€",
        "ì‹ ë¬¸ | ì¸í„°ë„·ì‹ ë¬¸ | ë°©ì†¡ | í†µì‹  | êµ­íšŒ | ë¬¸í™”ì²´ìœ¡ê´€ê´‘ë¶€ | ê³¼í•™ê¸°ìˆ ë°©ì†¡í†µì‹ ë¶€"
    ];

    const mediaMap = {
        '001': 'ì—°í•©ë‰´ìŠ¤', '005': 'êµ­ë¯¼ì¼ë³´', '020': 'ë™ì•„ì¼ë³´', '021': 'ë¬¸í™”ì¼ë³´', 
        '023': 'ì¡°ì„ ì¼ë³´', '025': 'ì¤‘ì•™ì¼ë³´', '028': 'í•œê²¨ë ˆ', '032': 'ê²½í–¥ì‹ ë¬¸',
        '081': 'ì„œìš¸ì‹ ë¬¸', '214': 'MBC', '055': 'SBS', '052': 'YTN', '056': 'KBS',
        '003': 'ë‚´ì¼ì‹ ë¬¸', '011': 'ì„œìš¸ê²½ì œ', '014': 'íŒŒì´ë‚¸ì…œë‰´ìŠ¤', '015': 'í•œêµ­ê²½ì œ', '018': 'ì´ë°ì¼ë¦¬',
        '009': 'ë§¤ì¼ê²½ì œ', '031': 'ì•„ì´ë‰´ìŠ¤24', '047': 'ì˜¤ë§ˆì´ë‰´ìŠ¤', '006': 'ë¯¸ë””ì–´ì˜¤ëŠ˜', '119': 'ë°ì¼ë¦¬ì•ˆ'
    };

    let nPage = 1, gPage = 1, yPage = 1;
    let nSort = 'date', gSort = 'date', ySort = 'date';
    let gCachedItems = [];

    // [ì¶”ê°€ ê¸°ëŠ¥] ê²°ê³¼ ë‚´ ë¦¬ìŠ¤íŠ¸ í•„í„°ë§ í•¨ìˆ˜
    function reSearchList(targetId, keyword) {
        const listContainer = document.getElementById(targetId);
        const items = listContainer.querySelectorAll('.item, .yt-card');
        const searchWord = keyword.toLowerCase();

        items.forEach(item => {
            const title = item.querySelector('.item-title').innerText.toLowerCase();
            if (title.includes(searchWord)) {
                item.style.display = 'block';
            } else {
                item.style.display = 'none';
            }
        });
    }

    function getDateQuery() {
        const start = document.getElementById('startDate').value;
        const end = document.getElementById('endDate').value;
        let dateQ = "";
        if (start) dateQ += ` after:${start}`;
        if (end) dateQ += ` before:${end}`;
        return dateQ;
    }

    function applyFilter(idx) {
        document.querySelectorAll('.filter-btn').forEach((btn, i) => btn.classList.toggle('active', i === idx));
        document.getElementById('queryInput').value = filterKeywords[idx];
        nPage = 1; gPage = 1; yPage = 1;
        fetchAll();
    }

    async function fetchNaver() {
        const q = document.getElementById('queryInput').value;
        const start = ((nPage - 1) * 15) + 1;
        
        const startDateVal = document.getElementById('startDate').value;
        const endDateVal = document.getElementById('endDate').value;
        const startDate = startDateVal ? new Date(startDateVal) : null;
        const endDate = endDateVal ? new Date(endDateVal) : null;
        if (endDate) endDate.setHours(23, 59, 59);

        const url = `https://openapi.naver.com/v1/search/news.json?query=${encodeURIComponent(q)}&display=50&start=${start}&sort=${nSort}`;
        
        try {
            const res = await fetch(PROXY + encodeURIComponent(url), {
                headers: { 'X-Naver-Client-Id': NAVER_ID, 'X-Naver-Client-Secret': NAVER_SECRET }
            });
            const data = await res.json();
            
            const filteredItems = (data.items || []).filter(item => {
                if (!startDate || !endDate) return true;
                const pubDate = new Date(item.pubDate);
                return pubDate >= startDate && pubDate <= endDate;
            });

            document.getElementById('naverList').innerHTML = filteredItems.map(i => {
                let pressName = "ë‰´ìŠ¤";
                if (i.link.includes("naver.com")) {
                    const match = i.link.match(/oid=(\d+)/);
                    if(match) pressName = mediaMap[match[1]] || `ë§¤ì²´(${match[1]})`;
                } else {
                    try {
                        const host = new URL(i.link).hostname.replace('www.', '');
                        pressName = host.split('.')[0]; 
                    } catch(e) {}
                }

                const formattedDate = new Date(i.pubDate).toLocaleString('ko-KR', {
                    year: 'numeric', month: 'numeric', day: 'numeric', hour: '2-digit', minute: '2-digit'
                });

                return `
                    <a href="${i.link}" target="_blank" class="item">
                        <div class="item-title">${i.title.replace(/<[^>]*>?/gm, '')}</div>
                        <div class="item-info">
                            <span class="press-badge">${pressName}</span>
                            <span>${formattedDate}</span>
                        </div>
                    </a>
                `;
            }).join('') || '<div style="padding:20px; text-align:center; color:#888;">ì§€ì •ëœ ê¸°ê°„ ë‚´ ë‰´ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
            
            document.getElementById('nPageNum').innerText = nPage;
            document.getElementById('naverList').scrollTop = 0;
        } catch(e) { console.error(e); }
    }

    async function fetchGoogle() {
        if (gPage === 1 || gCachedItems.length === 0) {
            const q = document.getElementById('queryInput').value + getDateQuery();
            const url = `https://news.google.com/rss/search?q=${encodeURIComponent(q)}&hl=ko&gl=KR&ceid=KR:ko`;
            try {
                const res = await fetch(PROXY + encodeURIComponent(url));
                const text = await res.text();
                const parser = new DOMParser();
                const xml = parser.parseFromString(text, "text/xml");
                gCachedItems = Array.from(xml.querySelectorAll("item"));
                if (gSort === 'date') {
                    gCachedItems.sort((a, b) => new Date(b.querySelector("pubDate").textContent) - new Date(a.querySelector("pubDate").textContent));
                }
            } catch(e) { gCachedItems = []; }
        }
        const start = (gPage - 1) * 15;
        const paged = gCachedItems.slice(start, start + 15);
        document.getElementById('googleList').innerHTML = paged.map(n => `
            <a href="${n.querySelector("link").textContent}" target="_blank" class="item">
                <div class="item-title">${n.querySelector("title").textContent}</div>
                <div class="item-info">
                    <span style="color:var(--primary); font-weight:bold;">${n.querySelector("source")?.textContent || ''}</span>
                    <span>${new Date(n.querySelector("pubDate").textContent).toLocaleDateString()}</span>
                </div>
            </a>
        `).join('') || 'ê²°ê³¼ ì—†ìŒ';
        document.getElementById('gPageNum').innerText = gPage;
        document.getElementById('googleList').scrollTop = 0;
    }

    async function fetchYoutube() {
        const q = document.getElementById('queryInput').value + getDateQuery();
        const order = (ySort === 'date') ? 'date' : 'relevance';
        const url = `https://www.googleapis.com/youtube/v3/search?part=snippet&q=${encodeURIComponent(q)}&maxResults=15&order=${order}&type=video&key=${GOOGLE_API_KEY}`;
        try {
            const res = await fetch(url);
            const data = await res.json();
            document.getElementById('ytList').innerHTML = (data.items || []).map(v => `
                <a href="https://www.youtube.com/watch?v=${v.id.videoId}" target="_blank" class="yt-card">
                    <div class="yt-thumb" style="background-image:url('${v.snippet.thumbnails.medium.url}')"></div>
                    <div class="item-title" style="font-size:0.8rem;">${v.snippet.title}</div>
                    <div class="item-info"><span>${v.snippet.channelTitle}</span><span>${new Date(v.snippet.publishedAt).toLocaleDateString()}</span></div>
                </a>
            `).join('') || 'ê²°ê³¼ ì—†ìŒ';
            document.getElementById('ytList').scrollTop = 0;
        } catch(e) { document.getElementById('ytList').innerHTML = 'API ì˜¤ë¥˜'; }
    }

    function updateSortUI(prefix, selected) {
        document.getElementById(prefix + 'SortDate').classList.toggle('active', selected === 'date');
        document.getElementById(prefix + 'SortSim').classList.toggle('active', (selected === 'sim' || selected === 'relevance'));
    }

    function setNaverSort(s) { nSort = s; nPage = 1; updateSortUI('n', s); fetchNaver(); }
    function setGoogleSort(s) { gSort = s; gPage = 1; gCachedItems = []; updateSortUI('g', s); fetchGoogle(); }
    function setYoutubeSort(s) { ySort = s; updateSortUI('y', s); fetchYoutube(); }

    function changeNPage(s) { nPage = Math.max(1, nPage + s); fetchNaver(); }
    function changeGPage(s) { gPage = Math.max(1, Math.min(Math.ceil(gCachedItems.length/15), gPage + s)); fetchGoogle(); }

    function fetchAll() { 
        // ìƒˆ ê²€ìƒ‰ ì‹œ ì¬ê²€ìƒ‰ì°½ ë¹„ìš°ê¸°
        document.querySelectorAll('.local-search').forEach(input => input.value = '');
        fetchNaver(); fetchGoogle(); fetchYoutube(); 
    }

    window.onload = function() {
        const today = new Date().toISOString().split('T')[0];
        const lastWeek = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
        document.getElementById('startDate').value = lastWeek;
        document.getElementById('endDate').value = today;
        applyFilter(0);
    };
</script>
</body>
</html>