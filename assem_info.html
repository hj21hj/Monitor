<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì œ22ëŒ€ êµ­íšŒ í†µí•© ì¸ì ì‚¬í•­ ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
    <style>
        :root { --primary: #003478; --accent: #0056b3; --bg: #f8f9fa; --border: #dee2e6; }
        body { font-family: 'Pretendard', sans-serif; background-color: var(--bg); margin: 0; padding: 20px; color: #333; }
        .container { max-width: 100%; margin: 0 auto; background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        
        header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid var(--primary); margin-bottom: 20px; padding-bottom: 15px; }
        h1 { color: var(--primary); font-size: 22px; margin: 0; }

        .search-area { display: flex; flex-direction: column; gap: 10px; margin-bottom: 20px; padding: 15px; background: #f1f3f5; border-radius: 8px; }
        .search-row { display: flex; gap: 10px; }
        select, input { padding: 12px; border: 1px solid #ced4da; border-radius: 6px; font-size: 15px; }
        select { background-color: white; width: 250px; cursor: pointer; }
        input { flex: 1; }
        button { padding: 12px 25px; background: var(--primary); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        button:hover { background: var(--accent); }

        .table-wrapper { overflow-x: auto; border: 1px solid var(--border); border-radius: 8px; }
        table { width: 100%; border-collapse: collapse; min-width: 1200px; font-size: 13px; }
        th { background: #e9ecef; padding: 12px; border-bottom: 2px solid var(--border); text-align: left; position: sticky; top: 0; white-space: nowrap; }
        td { padding: 10px 12px; border-bottom: 1px solid #eee; white-space: nowrap; }
        tr:hover { background-color: #f1f8ff; }

        .name-link { color: var(--primary); font-weight: 700; cursor: pointer; text-decoration: underline; }
        .badge { background: #eee; padding: 2px 6px; border-radius: 4px; font-size: 11px; }

        /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); overflow-y: auto; }
        .modal-content { background: white; margin: 50px auto; width: 700px; border-radius: 8px; overflow: hidden; box-shadow: 0 5px 20px rgba(0,0,0,0.3); }
        .modal-header { background: var(--primary); color: white; padding: 15px 20px; display: flex; justify-content: center; align-items: center; position: relative; }
        .modal-header h2 { font-size: 18px; margin: 0; }
        .close-btn { position: absolute; right: 20px; font-size: 24px; color: white; cursor: pointer; background: none; border: none; }
        
        .detail-table { width: 100%; border-collapse: collapse; border-top: 1px solid var(--border); }
        .detail-table th { background: #f8f9fa; width: 30%; padding: 12px 20px; border-bottom: 1px solid var(--border); color: #666; font-weight: 500; text-align: left; }
        .detail-table td { padding: 12px 20px; border-bottom: 1px solid var(--border); color: #111; font-size: 14px; white-space: normal; }
        .modal-footer { padding: 20px; text-align: center; }
        .footer-close { padding: 8px 30px; border: 1px solid var(--primary); color: var(--primary); background: white; font-weight: bold; cursor: pointer; }

        .loading { text-align: center; padding: 50px; display: none; font-size: 18px; color: var(--primary); }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>ğŸ›ï¸ ì œ22ëŒ€ êµ­íšŒ ì¸ì ì‚¬í•­ í†µí•© ê²€ìƒ‰</h1>
    </header>

    <div class="search-area">
        <div class="search-row">
            <select id="committeeSelect" onchange="handleFilter()">
                <option value="">ì „ì²´ ìœ„ì›íšŒ</option>
                <option value="ë¬¸í™”ì²´ìœ¡ê´€ê´‘ìœ„ì›íšŒ">ë¬¸í™”ì²´ìœ¡ê´€ê´‘ìœ„ì›íšŒ</option>
                <option value="êµ­ë°©ìœ„ì›íšŒ">êµ­ë°©ìœ„ì›íšŒ</option>
                <option value="ê¸°íšì¬ì •ìœ„ì›íšŒ">ê¸°íšì¬ì •ìœ„ì›íšŒ</option>
                <option value="ë²•ì œì‚¬ë²•ìœ„ì›íšŒ">ë²•ì œì‚¬ë²•ìœ„ì›íšŒ</option>
                <option value="êµìœ¡ìœ„ì›íšŒ">êµìœ¡ìœ„ì›íšŒ</option>
                <option value="ê³¼í•™ê¸°ìˆ ì •ë³´ë°©ì†¡í†µì‹ ìœ„ì›íšŒ">ê³¼í•™ê¸°ìˆ ì •ë³´ë°©ì†¡í†µì‹ ìœ„ì›íšŒ</option>
                <option value="ì™¸êµí†µì¼ìœ„ì›íšŒ">ì™¸êµí†µì¼ìœ„ì›íšŒ</option>
                <option value="í–‰ì •ì•ˆì „ìœ„ì›íšŒ">í–‰ì •ì•ˆì „ìœ„ì›íšŒ</option>
                <option value="ë†ë¦¼ì¶•ì‚°ì‹í’ˆí•´ì–‘ìˆ˜ì‚°ìœ„ì›íšŒ">ë†ë¦¼ì¶•ì‚°ì‹í’ˆí•´ì–‘ìˆ˜ì‚°ìœ„ì›íšŒ</option>
                <option value="ì‚°ì—…í†µìƒìì›ì¤‘ì†Œë²¤ì²˜ê¸°ì—…ìœ„ì›íšŒ">ì‚°ì—…í†µìƒìì›ì¤‘ì†Œë²¤ì²˜ê¸°ì—…ìœ„ì›íšŒ</option>
                <option value="ë³´ê±´ë³µì§€ìœ„ì›íšŒ">ë³´ê±´ë³µì§€ìœ„ì›íšŒ</option>
                <option value="í™˜ê²½ë…¸ë™ìœ„ì›íšŒ">í™˜ê²½ë…¸ë™ìœ„ì›íšŒ</option>
                <option value="êµ­í† êµí†µìœ„ì›íšŒ">êµ­í† êµí†µìœ„ì›íšŒ</option>
                <option value="ì •ë³´ìœ„ì›íšŒ">ì •ë³´ìœ„ì›íšŒ</option>
                <option value="ì—¬ì„±ê°€ì¡±ìœ„ì›íšŒ">ì—¬ì„±ê°€ì¡±ìœ„ì›íšŒ</option>
            </select>
            <input type="text" id="unifiedSearch" placeholder="ì˜ì›ëª…, ë³´ì¢Œê´€, ì„ ì„ë¹„ì„œê´€, ë¹„ì„œê´€ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" onkeyup="if(window.event.keyCode==13){handleFilter()}">
            <button onclick="handleFilter()">í†µí•© ê²€ìƒ‰</button>
        </div>
    </div>

    <div id="loading" class="loading">ğŸ“¡ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ê³  ìˆìŠµë‹ˆë‹¤...</div>

    <div class="table-wrapper">
        <table>
            <thead>
                <tr>
                    <th>ìˆœë²ˆ</th>
                    <th>ì„±ëª…</th>
                    <th>ì •ë‹¹</th>
                    <th>ì„ ê±°êµ¬</th>
                    <th>ì†Œì† ìœ„ì›íšŒ</th>
                    <th>ì „í™”ë²ˆí˜¸</th>
                    <th>ë³´ì¢Œê´€</th>
                    <th>ìƒì„¸</th>
                </tr>
            </thead>
            <tbody id="memberTableBody"></tbody>
        </table>
    </div>
</div>

<div id="detailModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>ìƒì„¸ë‚´ìš©</h2>
            <button class="close-btn" onclick="closeModal()">Ã—</button>
        </div>
        <table class="detail-table" id="detailContent">
            </table>
        <div class="modal-footer">
            <button class="footer-close" onclick="closeModal()">ë‹«ê¸°</button>
        </div>
    </div>
</div>

<script>
    const API_KEY = '4fbc27e65852496ab48087bcb355321a';
    const ENDPOINT = 'https://open.assembly.go.kr/portal/openapi/nwvrqwxyaytdsfvhu';
    let allMembers = [];

    window.onload = () => fetchAllAssemblyData();

    async function fetchAllAssemblyData() {
        document.getElementById('loading').style.display = 'block';
        try {
            const response = await fetch(`${ENDPOINT}?KEY=${API_KEY}&Type=json&pIndex=1&pSize=500`);
            const data = await response.json();
            if (data.nwvrqwxyaytdsfvhu) {
                allMembers = data.nwvrqwxyaytdsfvhu[1].row;
                renderTable(allMembers);
            }
        } catch (error) {
            console.error('API Error:', error);
            alert('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨');
        } finally {
            document.getElementById('loading').style.display = 'none';
        }
    }

    function handleFilter() {
        const committeeQuery = document.getElementById('committeeSelect').value;
        const textQuery = document.getElementById('unifiedSearch').value.trim().toLowerCase();
        
        const filtered = allMembers.filter(m => {
            const matchesCommittee = !committeeQuery || (m.CMITS && m.CMITS.includes(committeeQuery));
            const matchesText = !textQuery || 
                [m.HG_NM, m.STAFF, m.SECRETARY, m.SECRETARY2].some(val => val && val.toLowerCase().includes(textQuery));
            return matchesCommittee && matchesText;
        });
        renderTable(filtered);
    }

    function renderTable(data) {
        const tbody = document.getElementById('memberTableBody');
        tbody.innerHTML = data.map((item, index) => `
            <tr>
                <td>${index + 1}</td>
                <td class="name-link" onclick="openModal('${item.MONA_CD}')">${item.HG_NM}</td>
                <td><span class="badge">${item.POLY_NM}</span></td>
                <td>${item.ORIG_NM}</td>
                <td>${(item.CMITS || '').split(',')[0]}...</td>
                <td>${item.TEL_NO || '-'}</td>
                <td>${item.STAFF || '-'}</td>
                <td><button onclick="openModal('${item.MONA_CD}')" style="padding:4px 8px; font-size:11px;">ë³´ê¸°</button></td>
            </tr>
        `).join('');
    }

    function openModal(monaCd) {
        const item = allMembers.find(m => m.MONA_CD === monaCd);
        if (!item) return;

        const content = `
            <tr><th>ë²ˆí˜¸</th><td>${item.MONA_CD || '-'}</td></tr>
            <tr><th>í•œìëª…</th><td>${item.HJ_NM || '-'}</td></tr>
            <tr><th>ì˜ë¬¸ëª…ì¹­</th><td>${item.ENG_NM || '-'}</td></tr>
            <tr><th>ìŒ/ì–‘ë ¥</th><td>${item.BTH_GBN_NM || '-'}</td></tr>
            <tr><th>ìƒë…„ì›”ì¼</th><td>${item.BTH_DATE || '-'}</td></tr>
            <tr><th>ì •ë‹¹ëª…</th><td>${item.POLY_NM || '-'}</td></tr>
            <tr><th>ì„ ê±°êµ¬</th><td>${item.ORIG_NM || '-'}</td></tr>
            <tr><th>ëŒ€í‘œ ìœ„ì›íšŒ</th><td>${item.CMIT_NM || '-'}</td></tr>
            <tr><th>ì¬ì„ </th><td>${item.REELE_GBN_NM || '-'}</td></tr>
            <tr><th>ë‹¹ì„ </th><td>${item.UNITS || '-'}</td></tr>
            <tr><th>ì†Œì† ìœ„ì›íšŒ ëª©ë¡</th><td>${item.CMITS || '-'}</td></tr>
            <tr><th>ì„±ë³„</th><td>${item.SEX_GBN_NM || '-'}</td></tr>
            <tr><th>ì „í™”ë²ˆí˜¸</th><td>${item.TEL_NO || '-'}</td></tr>
            <tr><th>ì‚¬ë¬´ì‹¤ í˜¸ì‹¤</th><td>${item.ASSEM_ADDR || '-'}</td></tr>
            <tr><th>ì´ë©”ì¼</th><td>${item.E_MAIL || '-'}</td></tr>
            <tr><th>í™ˆí˜ì´ì§€</th><td>${item.HOMEPAGE ? `<a href="${item.HOMEPAGE}" target="_blank">${item.HOMEPAGE}</a>` : '-'}</td></tr>
            <tr><th>ë³´ì¢Œê´€</th><td>${item.STAFF || '-'}</td></tr>
            <tr><th>ì„ ì„ë¹„ì„œê´€</th><td>${item.SECRETARY || '-'}</td></tr>
            <tr><th>ë¹„ì„œê´€</th><td>${item.SECRETARY2 || '-'}</td></tr>
        `;
        
        document.getElementById('detailContent').innerHTML = content;
        document.getElementById('detailModal').style.display = 'block';
        document.body.style.overflow = 'hidden'; // ë°°ê²½ ìŠ¤í¬ë¡¤ ë°©ì§€
    }

    function closeModal() {
        document.getElementById('detailModal').style.display = 'none';
        document.body.style.overflow = 'auto';
    }

    // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
    window.onclick = function(event) {
        const modal = document.getElementById('detailModal');
        if (event.target == modal) closeModal();
    }
</script>

</body>
</html>